language: python
matrix:
  include:
  - language: generic-covered
    python: 3.7
    os: osx
  - python: 3.7
    dist: xenial
    os: linux
python:
- '3.7'
before_install:
- if [ $TRAVIS_OS_NAME == "osx" ]; then echo "Running on OS X"; echo $(python3 --version);
  echo $(python --version); else echo "Running on Linux"; sudo apt-get update; wget
  https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
  bash miniconda.sh -b -p $HOME/miniconda; export PATH="$HOME/miniconda/bin:$PATH";
  hash -r; conda config --set always_yes yes --set changeps1 no; conda config --append
  channels conda-forge; conda config --append channels cmutel; conda config --append
  channels pascallesage; conda update conda; conda info -a; echo $(python --version);
  fi
install:
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then conda create -n test-environment python=$TRAVIS_PYTHON_VERSION
  xarray pandas presamples xlrd numpy pytest pytest-cov coveralls klausen numexpr
  bw2io; source activate test-environment; pip3 install -e .; else pip3 install -r
  ci/macos-travis.txt; pip3 install -e .; fi
script:
- 'if [ "$TRAVIS_OS_NAME" == "linux" ]; then pwd; ls; pytest --cov=carculator; coveralls;
  if [ "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false" ]; then conda
  install conda-build anaconda-client; bash ci/conda_upload.sh;

  fi else pytest; fi'


deploy:
  provider: pypi
  user: __token__
  password:
    secure: "tjmsgBZWgI3gtfC1s3b1q9PO4rXW9S4Js4DeZpA53KeVJ65rWRe72WSiY42rxu53ZBZDUTAhp78rGJjDW3qHPrRyXTlI46KD4X
    15pYPw1CRl/pf3CVegsgGMeGUoK9RaUkDVAodm/THHWJ6r9leQAxIoxSicyjyT69O8kznETDOoh3gkT7JQQwPVgAAMgjXTSElj0LCfHe
    fhiubziG8oiRkaPPBdXXcUaeMySykod9YRNkxLJ/ziwzu3FLRqlRZFmH0fDZVm0TEVFxL3+xeFIIhez+KHHwRReM+Ys2arymNuafCkg
    7lBn0bsEKnkkDKWtdm/J1BomINjqgn/7aRF+jwwV4OZ8xX7CH6+ezexF0OJQkESvfk2fB8tty8h3USH28sMRsVsuYUb6Zin5JPF6IVA
    r4U/3iMe3UEHHM6M9ipXlxx6jfhlK7gtQZGbuhSAoJtSzBTRUjPyadZuiifOuFP7Kcac/V847T/8KumZ1x01WBzXMvsbmAPk68VrgDx
    AoNhrlBrQxrPfuTVK/LuDHxteNhZ0Op3+XFV1KSXBTnHoKfxJBNTGi6e1DqIGbpsxIhO3EfHTb6bnSn3Ru7y3dQCizweQE78XVk6RmJ
    rXD6GVZS9SKTV30BocMtfnNEq/Wg4WF7YBTk+lL2R5MhEvOIfL55+dOadVS2HLysZ4CYY="
  distributions: sdist bdist_wheel

